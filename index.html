<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CR Coach (MVP)</title>
  <meta name="description" content="Treine melhor no Clash Royale: veja seu histórico de batalhas e receba insights." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='46' fill='%2300E5FF'/%3E%3Ctext x='50' y='58' font-size='42' text-anchor='middle' fill='black' font-family='Arial'%3ECR%3C/text%3E%3C/svg%3E" />

  <style>
    :root{
      --bg: #0b0f1a;
      --panel: #111726;
      --muted: #8aa0b6;
      --text: #eaf2ff;
      --brand: #00e5ff;
      --brand-2: #7cf3c3;
      --ring: rgba(0,229,255,.35);
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-lg: 28px;
      --maxw: 1120px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:radial-gradient(1200px 700px at 10% -10%, #0d1b2a 0%, transparent 60%), radial-gradient(900px 500px at 90% 0%, #122b39 0%, transparent 55%), var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; line-height:1.5}
    a{color:inherit; text-decoration:none}
    .container{max-width:var(--maxw); margin-inline:auto; padding:0 20px}
    header{position:sticky; top:0; backdrop-filter:saturate(140%) blur(8px); background:rgba(11,15,26,.55); border-bottom:1px solid rgba(255,255,255,.06); z-index:10}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
    .brand-dot{width:12px; height:12px; border-radius:50%; background:linear-gradient(135deg,var(--brand),var(--brand-2)); box-shadow:0 0 0 4px rgba(0,229,255,.2)}
    .nav-right{display:flex; align-items:center; gap:10px}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 16px; border-radius:var(--radius-sm); border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); color:var(--text); box-shadow:var(--shadow); transition:.2s transform, .2s box-shadow, .2s background}
    .btn:hover{transform:translateY(-2px); box-shadow:0 14px 30px rgba(0,0,0,.45)}
    .btn.brand{border-color:transparent; background:linear-gradient(135deg, var(--brand), var(--brand-2)); color:#061018; font-weight:700}
    .hero{padding:64px 0 32px}
    .hero-grid{display:grid; grid-template-columns:1.2fr .8fr; gap:28px; align-items:center}
    .h1{font-size:clamp(28px, 4.2vw, 48px); line-height:1.05; letter-spacing:.2px; margin:0 0 14px}
    .lead{color:var(--muted); font-size:clamp(14px, 2.1vw, 18px); margin:0 0 24px}
    .pill{display:inline-flex; align-items:center; gap:8px; background:rgba(0,229,255,.08); color:#9ef9ff; border:1px solid rgba(0,229,255,.25); border-radius:999px; padding:8px 12px; font-size:13px; margin-bottom:16px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.1); border-radius:var(--radius); box-shadow:var(--shadow)}
    .panel-pad{padding:18px}
    .input{width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#0c1322; color:var(--text); outline:none}
    .input:focus{border-color:var(--brand); box-shadow:0 0 0 4px var(--ring)}
    .grid{display:grid; gap:18px}
    .grid-3{grid-template-columns:repeat(3, 1fr)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); padding:18px}
    .card h3{margin:0 0 6px; font-size:18px}
    .muted{color:var(--muted)}
    .table{width:100%; border-collapse:collapse; font-size:14px}
    .table th, .table td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.07)}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); font-size:12px}
    footer{padding:42px 0; color:var(--muted); text-align:center; border-top:1px solid rgba(255,255,255,.06); margin-top:48px}
    @media (max-width: 900px){ .hero-grid{grid-template-columns:1fr} .grid-3{grid-template-columns:1fr} .nav-right .hide-sm{display:none} }
  </style>
</head>
<body>
  <!-- NAV -->
  <header>
    <div class="container nav">
      <a class="brand" href="#">
        <span class="brand-dot"></span> CR Coach
      </a>
      <div class="nav-right">
        <a class="btn hide-sm" href="#como-usar">Como usar</a>
        <a class="btn brand" href="#coach">Abrir Coach</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container hero-grid">
      <div>
        <div class="pill">MVP • Visual limpo • Responsivo</div>
        <h1 class="h1">Treine melhor no Clash Royale com <span style="background:linear-gradient(135deg,var(--brand),var(--brand-2)); -webkit-background-clip:text; background-clip:text; color:transparent">insights claros</span>.</h1>
        <p class="lead">Cole seu <strong>TAG</strong>, veja o histórico de batalhas e descubra pontos para melhorar. Sem complicação.</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap">
          <a class="btn brand" href="#coach">Começar agora</a>
          <a class="btn" href="#features">Ver recursos</a>
        </div>
      </div>

      <div class="panel panel-pad">
        <h3 style="margin:0 0 10px">Prévia de resultados</h3>
        <p class="muted" style="margin-top:0">Exemplo visual do que você verá ao usar o Coach.</p>
        <div class="grid">
          <div class="card">
            <div class="badge">Taxa de vitória • 63%</div>
            <div class="muted">Últimas 20 partidas</div>
          </div>
          <div class="card">
            <div class="badge">Deck mais jogado</div>
            <div class="muted">Gigante • Arqueiras • Zap…</div>
          </div>
          <div class="card">
            <div class="badge">Dica rápida</div>
            <div class="muted">Você performa melhor de 18h–22h.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- COMO USAR -->
  <section id="como-usar" class="container">
    <h2 style="margin:0 0 12px">Como usar</h2>
    <p class="muted" style="margin-top:0">3 passos simples — sem cadastro.</p>
    <div class="grid grid-3">
      <div class="card"><h3>1) Copie o TAG</h3><p class="muted">No Clash Royale, pegue o seu TAG (ex.: <code>#ABCD123</code>).</p></div>
      <div class="card"><h3>2) Cole e busque</h3><p class="muted">Cole abaixo e clique em <em>Ver batalhas</em>.</p></div>
      <div class="card"><h3>3) Veja insights</h3><p class="muted">Acompanhe vitórias, decks e horários fortes.</p></div>
    </div>
  </section>

  <!-- COACH -->
  <section id="coach" class="container" style="margin-top:28px">
    <div class="panel panel-pad">
      <h2 style="margin:0 0 10px">Seu histórico</h2>
      <p class="muted" style="margin:0 0 12px">Cole o TAG do jogador (com ou sem <code>#</code>).</p>
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <input id="tagInput" class="input" placeholder="#ABCD123" style="flex:1; min-width:220px" />
        <button id="btnFetch" class="btn brand">Ver batalhas</button>
      </div>

      <div id="msg" class="muted" style="margin-top:12px"></div>

      <div id="results" style="margin-top:16px; overflow:auto; display:none">
        <table class="table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Modo</th>
              <th>Resultado</th>
              <th>Oponente</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">© <span id="y"></span> CR Coach — MVP. Feito com ♥</div>
  </footer>

  <script>
    // ano no rodapé
    document.getElementById('y').textContent = new Date().getFullYear();

    // util: normaliza TAG (remove espaços e "#")
    function cleanTag(tag){
      return String(tag || '')
        .trim()
        .replace(/^#/,'')
        .toUpperCase();
    }

    // evento do botão
    document.getElementById('btnFetch').addEventListener('click', async () => {
      const raw = document.getElementById('tagInput').value;
      const tag = cleanTag(raw);
      const msg = document.getElementById('msg');
      const tbody = document.getElementById('tbody');
      const results = document.getElementById('results');

      if(!tag){ msg.textContent = 'Digite seu TAG para buscar.'; return; }

      msg.textContent = 'Buscando...';
      tbody.innerHTML = '';
      results.style.display = 'none';

      try {
        // Ajuste a URL conforme seu deploy:
        // Cloudflare Pages Functions: /api/battlelog?tag=XXXXX
        // (Seu repo tem functions/api/battlelog.js)
        const res = await fetch(`/api/battlelog?tag=${encodeURIComponent(tag)}`);
        if(!res.ok) throw new Error('Falha ao buscar');

        const data = await res.json(); // espere uma lista de partidas
        if(!Array.isArray(data) || data.length === 0){
          msg.textContent = 'Não encontrei batalhas para esse TAG.';
          return;
        }

        for(const b of data.slice(0,20)){ // mostra até 20
          const tr = document.createElement('tr');
          const date = b.battleTime ? new Date(b.battleTime).toLocaleString() : '-';
          const mode = b.gameMode?.name || b.type || '-';
          const outcome = b.opponentCrowns != null && b.teamCrowns != null
            ? (b.teamCrowns > b.opponentCrowns ? 'Vitória' : (b.teamCrowns < b.opponentCrowns ? 'Derrota' : 'Empate'))
            : (b.result || '-');
          const opp = (b.opponentName || b.opponentTag || '-');

          tr.innerHTML = `
            <td>${date}</td>
            <td>${mode}</td>
            <td>${outcome}</td>
            <td>${opp}</td>
          `;
          tbody.appendChild(tr);
        }

        results.style.display = 'block';
        msg.textContent = `Mostrando ${Math.min(20, data.length)} partidas.`;
      } catch (e){
        msg.textContent = 'Não consegui buscar agora. O site está ok — tente novamente mais tarde.';
      }
    });
  </script>
</body>
</html>
